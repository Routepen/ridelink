{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA;;AACA,MAAM,UAAU,QAAQ,SAAR,CAAhB;AACA,MAAM,aAAa,QAAQ,aAAR,CAAnB;AACA,MAAM,UAAU,QAAQ,SAAR,CAAhB;AACA,MAAM,KAAK,QAAQ,IAAR,CAAX;AACA,MAAM,WAAW,QAAQ,UAAR,CAAjB;AACA,MAAM,WAAW,QAAQ,UAAR,CAAjB;AACA,MAAM,mBAAmB,QAAQ,mBAAR,EAA6B,QAAtD;AACA,MAAM,OAAO,QAAQ,eAAR,CAAb;AACA,MAAM,QAAQ,QAAQ,gBAAR,CAAd;AACA,MAAM,MAAM,SAAZ;;AAEA,SAAS,OAAT,GAAmB,QAAQ,UAAR,CAAnB;AACA,IAAI,OAAO,SAAS,gBAAT,CAA0B,yCAA1B,CAAX;AACA,SAAS,OAAT,CAAiB,wEAAjB;AACA,IAAI,KAAK,SAAS,UAAlB;;AAIA,GAAG,EAAH,CAAM,OAAN,EAAe,QAAQ,KAAR,CAAc,IAAd,CAAmB,OAAnB,EAA4B,mBAA5B,CAAf;AACA,GAAG,IAAH,CAAQ,MAAR,EAAgB,YAAW;AAC1B,SAAQ,GAAR,CAAY,kBAAZ;AACA,CAFD;;AAKA,IAAI,GAAJ,CAAQ,MAAR,EAAiB,QAAQ,GAAR,CAAY,IAAZ,IAAoB,IAArC;AACA,IAAI,GAAJ,CAAQ,aAAR,EAAuB,KAAvB;;AAEA,IAAI,GAAJ,CAAQ,QAAQ,MAAR,CAAe,YAAY,SAA3B,CAAR;AACA;AACA,IAAI,GAAJ,CAAQ,WAAW,UAAX,CAAsB,EAAC,UAAU,KAAX,EAAtB,CAAR;;AAEA;AACA,IAAI,GAAJ,CAAQ,WAAW,IAAX,EAAR;;AAGA;AACA,IAAI,GAAJ,CAAQ,GAAR,EAAa,UAAU,GAAV,EAAe,GAAf,EAAoB;AAChC,KAAI,MAAJ,CAAW,aAAX;AACA,CAFD;;AAIA,SAAS,GAAT,CAAa,IAAI,gBAAJ,CAAqB;AAChC,WAAU,kBADsB;AAEhC,eAAc,kCAFkB;AAGhC,cAAa,8CAHmB;AAIhC,gBAAe,CAAC,IAAD,EAAO,YAAP,EAAqB,WAArB,EAAkC,QAAlC,EAA4C,OAA5C,EAAqD,QAArD,EAA+D,MAA/D,EAAuE,oBAAvE;AAJiB,CAArB,EAMZ,UAAS,WAAT,EAAsB,YAAtB,EAAoC,OAApC,EAA6C,EAA7C,EAAiD;AAChD,SAAQ,QAAR,CAAiB,YAAU;AAC1B,OAAK,YAAL,CAAkB,EAAE,YAAY,QAAQ,EAAtB,EAAlB,EAA8C,UAAU,GAAV,EAAe,IAAf,EAAqB;AAClE,OAAI,GAAJ,EACC,OAAO,KAAK,GAAL,CAAP;AACD,OAAI,IAAJ,EAAU;AACT,WAAO,KAAK,IAAL,EAAW,IAAX,CAAP;AACA,IAFD,MAEO;AACN,QAAI,UAAU,IAAI,IAAJ,EAAd;AACA,YAAQ,QAAR,CAAiB,EAAjB,GAAsB,QAAQ,EAA9B;AACA,YAAQ,QAAR,CAAiB,KAAjB,GAAyB,WAAzB;AACA,YAAQ,QAAR,CAAiB,IAAjB,GAAwB,QAAQ,IAAR,CAAa,SAAb,GAAyB,GAAzB,GAA+B,QAAQ,IAAR,CAAa,UAApE;AACA,YAAQ,QAAR,CAAiB,KAAjB,GAAyB,CAAC,QAAQ,MAAR,CAAe,CAAf,EAAkB,KAAlB,IAA2B,EAA5B,EAAgC,WAAhC,EAAzB;AACA,YAAQ,QAAR,CAAiB,MAAjB,GAA0B,QAAQ,OAAlC;AACA,YAAQ,QAAR,CAAiB,MAAjB,GAA0B,QAAQ,MAAlC;AACA,YAAQ,QAAR,CAAiB,IAAjB,GAAwB,QAAQ,IAAhC;;AAEA,YAAQ,IAAR,CAAa,UAAS,GAAT,EAAc;AAC1B,SAAI,GAAJ,EACC,MAAM,GAAN;AACD,YAAO,KAAK,IAAL,EAAW,OAAX,CAAP;AACA,KAJD;AAKA;AACD,UAAO,GAAG,GAAH,EAAQ,IAAR,CAAP;AACA,GAtBD;AAuBA,EAxBD;AAyBA,CAhCW,CAAb;AAkCA,IAAI,GAAJ,CAAQ,UAAR,EAAoB,UAAS,GAAT,EAAa,GAAb,EAAiB;AACpC,KAAI,IAAJ,CAAS,OAAT;AACA,CAFD;;AAIA,IAAI,GAAJ,CAAQ,gBAAR,EAA0B,UAAS,GAAT,EAAa,GAAb,EAAiB,IAAjB,EAAsB;AAC/C,UAAS,YAAT,CAAsB,UAAtB,EAAkC,EAAC,OAAM,CAAC,sBAAD,CAAP,EAAlC,EAAoE,GAApE,EAAwE,GAAxE,EAA4E,IAA5E;AACA,CAFD;;AAIA,IAAI,GAAJ,CAAQ,yBAAR,EAAmC,UAAS,GAAT,EAAa,GAAb,EAAiB,IAAjB,EAAuB;AACzD,UAAS,YAAT,CAAsB,UAAtB,EAAkC,EAAC,iBAAiB,UAAlB,EAA8B,iBAAiB,GAA/C,EAAlC,EAAuF,GAAvF,EAA2F,GAA3F,EAA+F,IAA/F;AACA,CAFD;AAGA,IAAI,GAAJ,CAAQ,SAAR,EAAmB,UAAS,GAAT,EAAa,GAAb,EAAiB,CAEnC,CAFD;AAGA,IAAI,GAAJ,CAAQ,YAAR,EAAsB,UAAS,GAAT,EAAa,GAAb,EAAiB;AACtC;AACA,CAFD;;AAIA,IAAI,IAAJ,CAAS,SAAT,EAAoB,UAAU,GAAV,EAAe,GAAf,EAAoB;AACvC,KAAI,WAAW,MAAM;AACpB,UAAQ,IAAI,IAAJ,CAAS,MADG;AAEpB,eAAa,IAAI,IAAJ,CAAS,WAFF;AAGpB,UAAQ,0BAHY;AAIpB,UAAO,CACN,0BADM;AAJa,EAAN,CAAf;;AASA,UAAS,IAAT,CAAc,UAAS,GAAT,EAAa;AAC1B,MAAG,GAAH,EAAQ,MAAM,GAAN;AACR,UAAQ,GAAR,CAAY,gBAAZ;AACA,EAHD;AAIA,KAAI,UAAJ,CAAe,GAAf;AACA;AACA,CAhBD;;AAkBA,IAAI,MAAJ,CAAW,IAAI,GAAJ,CAAQ,MAAR,CAAX,EAA4B,YAAW;AACtC,SAAQ,GAAR,CAAY,iBAAZ,EAA+B,IAAI,GAAJ,CAAQ,MAAR,CAA/B;AACA,CAFD","file":"index-compiled.js","sourcesContent":["'use strict'\r\nconst express = require('express');\r\nconst bodyParser = require('body-parser');\r\nconst request = require('request');\r\nconst fs = require('fs');\r\nconst mongoose = require('mongoose');\r\nconst passport = require('passport');\r\nconst FacebookStrategy = require('passport-facebook').Strategy;\r\nconst User = require('./models/User');\r\nconst Route = require('./models/Route');\r\nconst app = express();\r\n\r\nmongoose.Promise = require('bluebird');\r\nvar conn = mongoose.createConnection('ds161169.mlab.com:61169/heroku_9170g7ps');\r\nmongoose.connect('mongodb://victorcheng:victor97@ds161169.mlab.com:61169/heroku_9170g7ps');\r\nvar db = mongoose.connection;\r\n\r\n\r\n\r\ndb.on('error', console.error.bind(console, 'connection error:'));\r\ndb.once('open', function() {\r\n\tconsole.log(\"we're connected!\");\r\n});\r\n\r\n\r\napp.set('port', (process.env.PORT || 5000));\r\napp.set('view engine', 'ejs');\r\n\r\napp.use(express.static(__dirname + '/public'));\r\n// parse application/x-www-form-urlencoded\r\napp.use(bodyParser.urlencoded({extended: false}));\r\n\r\n// parse application/json\r\napp.use(bodyParser.json());\r\n\r\n\r\n// index\r\napp.get('/', function (req, res) {\r\n\tres.render('driver_maps');\r\n});\r\n\r\npassport.use(new FacebookStrategy({\r\n\t\tclientID: \"1122786494515943\",\r\n\t\tclientSecret: \"f6cd89a5fe00867021469477156f95a6\",\r\n\t\tcallbackURL: \"http://localhost:3000/auth/facebook/callback\",\r\n\t\tprofileFields: ['id', 'first_name', 'last_name', 'photos', 'email', 'gender', 'link', 'token_for_business']\r\n\t},\r\n\tfunction(accessToken, refreshToken, profile, cb) {\r\n\t\tprocess.nextTick(function(){\r\n\t\t\tUser.findOrCreate({ facebookId: profile.id }, function (err, user) {\r\n\t\t\t\tif (err)\r\n\t\t\t\t\treturn done(err);\r\n\t\t\t\tif (user) {\r\n\t\t\t\t\treturn done(null, user);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tvar newUser = new User();\r\n\t\t\t\t\tnewUser.facebook.id = profile.id;\r\n\t\t\t\t\tnewUser.facebook.token = accessToken;\r\n\t\t\t\t\tnewUser.facebook.name = profile.name.givenName + ' ' + profile.name.familyName;\r\n\t\t\t\t\tnewUser.facebook.email = (profile.emails[0].value || '').toLowerCase();\r\n\t\t\t\t\tnewUser.facebook.photos = profile.picture;\r\n\t\t\t\t\tnewUser.facebook.gender = profile.gender;\r\n\t\t\t\t\tnewUser.facebook.link = profile.link;\r\n\r\n\t\t\t\t\tnewUser.save(function(err) {\r\n\t\t\t\t\t\tif (err)\r\n\t\t\t\t\t\t\tthrow err;\r\n\t\t\t\t\t\treturn done(null, newUser);\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\treturn cb(err, user);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n));\r\napp.get('/profile', function(req,res){\r\n\tres.send(\"hello\");\r\n});\r\n\r\napp.get('/auth/facebook', function(req,res,next){\r\n\tpassport.authenticate('facebook', {scope:[\"public_profile,email\"]})(req,res,next);\r\n});\r\n\r\napp.get('/auth/facebook/callback', function(req,res,next) {\r\n\tpassport.authenticate('facebook', {successRedirect: '/profile', failureRedirect: '/'})(req,res,next);\r\n});\r\napp.get('/logout', function(req,res){\r\n\r\n});\r\napp.get('/addroute/', function(req,res){\r\n // add into dadtabase and\r\n});\r\n\r\napp.post('/route/', function (req, res) {\r\n\tvar newRoute = Route({\r\n\t\torigin: req.body.origin,\r\n\t\tdestination: req.body.destination,\r\n\t\tdriver: \"58b25a4e4837cb41284df95d\",\r\n\t\triders:[\r\n\t\t\t\"58b25a4e4837cb41284df95d\"\r\n\t\t]\r\n\t});\r\n\r\n\tnewRoute.save(function(err){\r\n\t\tif(err) throw err;\r\n\t\tconsole.log(\"Route created!\");\r\n\t});\r\n\tres.sendStatus(200);\r\n\t//send res.object_id \r\n});\r\n\r\napp.listen(app.get('port'), function() {\r\n\tconsole.log('running on port', app.get('port'))\r\n});\r\n"]}